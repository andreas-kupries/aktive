# -*- tcl -*- tcl.tk//DSL tcltest//EN//2.0 tcl.tk//DSL tcltest//EN//2.0
## (c) 2023 Andreas Kupries
# # ## ### ##### ######## ############# #####################
## AKTIVE. Complex transformers - Binary

kt check Tcl     8.6
kt check tcltest 2

# # ## ### ##### ######## ############# #####################

kt local testing aktive

kt source support/util.tcl

# # ## ### ##### ######## ############# #####################
## Syntax

syntax {
    add	    {src0 src1}
    div     {src0 src1}
    mul	    {src0 src1}
    sub	    {src0 src1}
    pow	    {src0 src1}
} {aktive op cmath}

# # ## ### ##### ######## ############# #####################
##

set real      [gradx]
set imaginary [aktive op flip x $real]
set a         [aktive op montage z $real $imaginary]
set b         [aktive op montage z $imaginary $real]

foreach {op expected} {
    add {
	19 19  19 19  19 19  19 19  19 19
	19 19  19 19  19 19  19 19  19 19
	19 19  19 19  19 19  19 19  19 19
	19 19  19 19  19 19  19 19  19 19
    }
    div {
	0       1      0.1108  0.9938 0.2321  0.9727 0.3623  0.9321 0.4979  0.8672
	0.6335  0.7738 0.7610  0.6488 0.8705  0.4922 0.9514  0.3081 0.9945  0.1050
	0.9945 -0.1050 0.9514 -0.3081 0.8705 -0.4922 0.7610 -0.6488 0.6335 -0.7738
	0.4979 -0.8672 0.3623 -0.9321 0.2321 -0.9727 0.1108 -0.9938 0      -1
    }
    mul {
	0 361  0 325  0 293  0 265  0 241
	0 221  0 205  0 193  0 185  0 181
	0 181  0 185  0 193  0 205  0 221
	0 241  0 265  0 293  0 325  0 361
    }
    sub {
	= -19  19  -17  17  -15  15  -13  13  -11  11
	=  -9   9   -7   7   -5   5   -3   3   -1   1
	=   1  -1    3  -3    5  -5    7  -7    9  -9
	=  11 -11   13 -13   15 -15   17 -17   19 -19
    }
    pow {
	=          -5816101320.2769 -1978419655660302621474816      2814336118253433651200      -8431971832282816184320
	= 26445301922932875264           -43353803923883696128          242981826057622016          -293422805581575424
	=     2723073049763428              -2767135554044580.5000          41330022976708.6484         -37114162262685.1484
	=         915573961699.0859             -692915747995.7328             30935154341.1163            -16256796622.2218
	=           1549198793.0175                -269923836.4975                96541403.0805                36021629.6831
	=              3683533.5233                   8739121.3345                 -796029.1029                  844933.9292
	=              -133450.2449                   -115903.0312                   27291.7947                  -15090.8218
	=                -1372.7194                      5801.2680                    -269.1471                   -1133.5812
	=                   78.1464                       208.1115                      -7.1250                     -39.3784
	=                   -1.7941                         6.3918                       0.8229                      -0.5682
    }
} {
    # functions to debug ...
    if {![llength $expected] || ($op in {})} {
	puts   "\nXX $op ........................................................................"
	puts   "XX INPUT [pixels/ $a]"
	puts   "XX INPUT [pixels/ $b]"
	puts   "XX RESLT [4f [pixels/ [aktive op cmath $op $a $b]]]"
	puts   "XX EXP.. $expected\n"
    }

    test aktive-op-cmath-${op}-2.0 "aktive op cmath $op" -body {
	astcl aktive op cmath $op $a $b
    } -match image -result [makei op::cmath::$op 0 0 20 1 2 {} $expected]
}

unset real imaginary a b
##
# # ## ### ##### ######## ############# #####################
cleanupTests
return
