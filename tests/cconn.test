# -*- tcl -*- tcl.tk//DSL tcltest//EN//2.0 tcl.tk//DSL tcltest//EN//2.0
## (c) 2024 Andreas Kupries
# # ## ### ##### ######## ############# #####################
## AKTIVE. Connected components, retrieval and region image

kt check Tcl     8.6 9
kt check tcltest 2

# # ## ### ##### ######## ############# #####################

kt local testing aktive

kt source support/util.tcl

# # ## ### ##### ######## ############# #####################
## Syntax

syntax {
    get      src
    labeled {src args}
} {aktive op connected-components}

# # ## ### ##### ######## ############# #####################
##

test aktive-op-connected-components-get-2.0 "aktive op connected-components get" -body {
    cc.pretty [aktive op connected-components get \
	[aktive image from matrix width 33 height 11 values {*}[bw {
	    _ _ _ _ _ * _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
	    _ _ _ _ _ * _ _ * * _ _ * * * _ * * * * * _ _ _ * * * * * * * _ _
	    * * * * * * _ _ * * _ _ * _ * _ * _ _ _ * _ _ * * * * * * * * * _
	    _ _ _ _ _ _ _ * * _ _ _ * * * _ * _ _ _ * _ * * * * * * * * * * *
	    _ * * * * * * * _ * _ _ _ _ _ _ * _ _ _ * _ * * * _ _ _ _ _ * * *
	    _ * _ _ _ _ _ _ _ * _ _ _ _ _ _ * _ _ _ * _ * * _ _ _ * _ _ _ * *
	    _ * _ * * * * * * * _ _ _ _ _ _ * * * * * _ _ * * _ _ * _ _ * * _
	    _ _ * * _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ * * _ * _ * * _ _
	    _ * * _ _ * * * * * * _ * * * * * * * * _ _ _ _ _ _ _ * _ _ _ _ _
	    _ * * _ _ * _ _ _ _ _ _ * * * * * * * * _ _ * * * * * * * * * * *
	    _ _ _ _ _ * _ _ _ _ _ _ * * _ _ _ _ * * _ _ _ _ _ _ * * * _ _ _ _
	}]]]
} -result {1 {
    area 8
    box {0 5 0 2}
    centroid {3.1250 1.6250}
    parts {
        {0 5 5} {1 5 5} {2 0 5}
    }
}
2 {
    area 15
    box {1 9 1 6}
    centroid {5.2667 3.4000}
    parts {
        {1 8 9} {2 8 9} {3 7 8} {4 1 7} {5 1 1} {6 1 1}
    }
}
3 {
    area 8
    box {12 14 1 3}
    centroid {13.0000 2.0000}
    parts {
        {1 12 14} {2 12 12} {2 14 14} {3 12 14}
    }
}
4 {
    area 18
    box {16 20 1 6}
    centroid {18.0000 3.5000}
    parts {
        {1 16 20} {2 16 16} {2 20 20} {3 16 16} {3 20 20} {4 16 16}
        {4 20 20} {5 16 16} {5 20 20} {6 16 20}
    }
}
5 {
    area 45
    box {22 32 1 7}
    centroid {27.0000 3.4222}
    parts {
        {1 24 30} {2 23 31} {3 22 32} {4 22 24} {4 30 32} {5 22 23}
        {5 31 32} {6 23 24} {6 30 31} {7 24 25} {7 29 30}
    }
}
6 {
    area 15
    box {1 9 4 9}
    centroid {4.7333 6.6000}
    parts {
        {4 9 9} {5 9 9} {6 3 9} {7 2 3} {8 1 2} {9 1 2}
    }
}
7 {
    area 18
    box {22 32 5 10}
    centroid {27.0000 8.6111}
    parts {
        {5 27 27} {6 27 27} {7 27 27} {8 27 27} {9 22 32} {10 26 28}
    }
}
8 {
    area 8
    box {5 10 8 10}
    centroid {6.8750 8.3750}
    parts {
        {8 5 10} {9 5 5} {10 5 5}
    }
}
9 {
    area 20
    box {12 19 8 10}
    centroid {15.5000 8.8000}
    parts {
        {8 12 19} {9 12 19} {10 12 13} {10 18 19}
    }
}}

# # ## ### ##### ######## ############# #####################

set meta {cc {1 {area 8 box {0 5 0 2} centroid {3.125 1.625}} 2 {area 15 box {1 9 1 6} centroid {5.266666666666667 3.4}} 3 {area 8 box {12 14 1 3} centroid {13.0 2.0}} 4 {area 18 box {16 20 1 6} centroid {18.0 3.5}} 5 {area 45 box {22 32 1 7} centroid {27.0 3.422222222222222}} 6 {area 15 box {1 9 4 9} centroid {4.733333333333333 6.6}} 7 {area 18 box {22 32 5 10} centroid {27.0 8.61111111111111}} 8 {area 8 box {5 10 8 10} centroid {6.875 8.375}} 9 {area 20 box {12 19 8 10} centroid {15.5 8.8}}}}

# # ## ### ##### ######## ############# #####################

test aktive-op-connected-components-labeled-2.0 "aktive op connected-components labeled, input geometry" -body {
    astclx 33 aktive op connected-components labeled \
	[aktive image from matrix width 33 height 11 values {*}[bw {
	    _ _ _ _ _ * _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
	    _ _ _ _ _ * _ _ * * _ _ * * * _ * * * * * _ _ _ * * * * * * * _ _
	    * * * * * * _ _ * * _ _ * _ * _ * _ _ _ * _ _ * * * * * * * * * _
	    _ _ _ _ _ _ _ * * _ _ _ * * * _ * _ _ _ * _ * * * * * * * * * * *
	    _ * * * * * * * _ * _ _ _ _ _ _ * _ _ _ * _ * * * _ _ _ _ _ * * *
	    _ * _ _ _ _ _ _ _ * _ _ _ _ _ _ * _ _ _ * _ * * _ _ _ * _ _ _ * *
	    _ * _ * * * * * * * _ _ _ _ _ _ * * * * * _ _ * * _ _ * _ _ * * _
	    _ _ * * _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ * * _ * _ * * _ _
	    _ * * _ _ * * * * * * _ * * * * * * * * _ _ _ _ _ _ _ * _ _ _ _ _
	    _ * * _ _ * _ _ _ _ _ _ * * * * * * * * _ _ * * * * * * * * * * *
	    _ _ _ _ _ * _ _ _ _ _ _ * * _ _ _ _ * * _ _ _ _ _ _ * * * _ _ _ _
	}]]
} -match image -result [makei image::from::sparse::ranges 0 0 33 11 1 {geometry {0 0 33 11} ranges {{0 5 5 1.0} {1 5 5 1.0} {1 8 9 2.0} {1 12 14 3.0} {1 16 20 4.0} {1 24 30 5.0} {2 0 5 1.0} {2 8 9 2.0} {2 12 12 3.0} {2 14 14 3.0} {2 16 16 4.0} {2 20 20 4.0} {2 23 31 5.0} {3 7 8 2.0} {3 12 14 3.0} {3 16 16 4.0} {3 20 20 4.0} {3 22 32 5.0} {4 1 7 2.0} {4 9 9 6.0} {4 16 16 4.0} {4 20 20 4.0} {4 22 24 5.0} {4 30 32 5.0} {5 1 1 2.0} {5 9 9 6.0} {5 16 16 4.0} {5 20 20 4.0} {5 22 23 5.0} {5 27 27 7.0} {5 31 32 5.0} {6 1 1 2.0} {6 3 9 6.0} {6 16 20 4.0} {6 23 24 5.0} {6 27 27 7.0} {6 30 31 5.0} {7 2 3 6.0} {7 24 25 5.0} {7 27 27 7.0} {7 29 30 5.0} {8 1 2 6.0} {8 5 10 8.0} {8 12 19 9.0} {8 27 27 7.0} {9 1 2 6.0} {9 5 5 8.0} {9 12 19 9.0} {9 22 32 7.0} {10 5 5 8.0} {10 12 13 9.0} {10 18 19 9.0} {10 26 28 7.0}}} {
    0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 1 0 0 2 2 0 0 3 3 3 0 4 4 4 4 4 0 0 0 5 5 5 5 5 5 5 0 0
    1 1 1 1 1 1 0 0 2 2 0 0 3 0 3 0 4 0 0 0 4 0 0 5 5 5 5 5 5 5 5 5 0
    0 0 0 0 0 0 0 2 2 0 0 0 3 3 3 0 4 0 0 0 4 0 5 5 5 5 5 5 5 5 5 5 5
    0 2 2 2 2 2 2 2 0 6 0 0 0 0 0 0 4 0 0 0 4 0 5 5 5 0 0 0 0 0 5 5 5
    0 2 0 0 0 0 0 0 0 6 0 0 0 0 0 0 4 0 0 0 4 0 5 5 0 0 0 7 0 0 0 5 5
    0 2 0 6 6 6 6 6 6 6 0 0 0 0 0 0 4 4 4 4 4 0 0 5 5 0 0 7 0 0 5 5 0
    0 0 6 6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5 5 0 7 0 5 5 0 0
    0 6 6 0 0 8 8 8 8 8 8 0 9 9 9 9 9 9 9 9 0 0 0 0 0 0 0 7 0 0 0 0 0
    0 6 6 0 0 8 0 0 0 0 0 0 9 9 9 9 9 9 9 9 0 0 7 7 7 7 7 7 7 7 7 7 7
    0 0 0 0 0 8 0 0 0 0 0 0 9 9 0 0 0 0 9 9 0 0 0 0 0 0 7 7 7 0 0 0 0
} $meta]

test aktive-op-connected-components-labeled-2.1 "aktive op connected-components labeled, bounding box" -body {
    astclx 33 aktive op connected-components labeled \
	[aktive image from matrix width 33 height 11 values {*}[bw {
	    _ _ _ _ _ * _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
	    _ _ _ _ _ * _ _ * * _ _ * * * _ * * * * * _ _ _ * * * * * * * _ _
	    * * * * * * _ _ * * _ _ * _ * _ * _ _ _ * _ _ * * * * * * * * * _
	    _ _ _ _ _ _ _ * * _ _ _ * * * _ * _ _ _ * _ * * * * * * * * * * *
	    _ * * * * * * * _ * _ _ _ _ _ _ * _ _ _ * _ * * * _ _ _ _ _ * * *
	    _ * _ _ _ _ _ _ _ * _ _ _ _ _ _ * _ _ _ * _ * * _ _ _ * _ _ _ * *
	    _ * _ * * * * * * * _ _ _ _ _ _ * * * * * _ _ * * _ _ * _ _ * * _
	    _ _ * * _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ * * _ * _ * * _ _
	    _ * * _ _ * * * * * * _ * * * * * * * * _ _ _ _ _ _ _ * _ _ _ _ _
	    _ * * _ _ * _ _ _ _ _ _ * * * * * * * * _ _ * * * * * * * * * * *
	    _ _ _ _ _ * _ _ _ _ _ _ * * _ _ _ _ * * _ _ _ _ _ _ * * * _ _ _ _
	}]] bbox 1
} -match image -result [makei image::from::sparse::ranges 0 0 33 11 1 {geometry {0 0 0 0} ranges {{0 5 5 1.0} {1 5 5 1.0} {1 8 9 2.0} {1 12 14 3.0} {1 16 20 4.0} {1 24 30 5.0} {2 0 5 1.0} {2 8 9 2.0} {2 12 12 3.0} {2 14 14 3.0} {2 16 16 4.0} {2 20 20 4.0} {2 23 31 5.0} {3 7 8 2.0} {3 12 14 3.0} {3 16 16 4.0} {3 20 20 4.0} {3 22 32 5.0} {4 1 7 2.0} {4 9 9 6.0} {4 16 16 4.0} {4 20 20 4.0} {4 22 24 5.0} {4 30 32 5.0} {5 1 1 2.0} {5 9 9 6.0} {5 16 16 4.0} {5 20 20 4.0} {5 22 23 5.0} {5 27 27 7.0} {5 31 32 5.0} {6 1 1 2.0} {6 3 9 6.0} {6 16 20 4.0} {6 23 24 5.0} {6 27 27 7.0} {6 30 31 5.0} {7 2 3 6.0} {7 24 25 5.0} {7 27 27 7.0} {7 29 30 5.0} {8 1 2 6.0} {8 5 10 8.0} {8 12 19 9.0} {8 27 27 7.0} {9 1 2 6.0} {9 5 5 8.0} {9 12 19 9.0} {9 22 32 7.0} {10 5 5 8.0} {10 12 13 9.0} {10 18 19 9.0} {10 26 28 7.0}}} {
    0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 1 0 0 2 2 0 0 3 3 3 0 4 4 4 4 4 0 0 0 5 5 5 5 5 5 5 0 0
    1 1 1 1 1 1 0 0 2 2 0 0 3 0 3 0 4 0 0 0 4 0 0 5 5 5 5 5 5 5 5 5 0
    0 0 0 0 0 0 0 2 2 0 0 0 3 3 3 0 4 0 0 0 4 0 5 5 5 5 5 5 5 5 5 5 5
    0 2 2 2 2 2 2 2 0 6 0 0 0 0 0 0 4 0 0 0 4 0 5 5 5 0 0 0 0 0 5 5 5
    0 2 0 0 0 0 0 0 0 6 0 0 0 0 0 0 4 0 0 0 4 0 5 5 0 0 0 7 0 0 0 5 5
    0 2 0 6 6 6 6 6 6 6 0 0 0 0 0 0 4 4 4 4 4 0 0 5 5 0 0 7 0 0 5 5 0
    0 0 6 6 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5 5 0 7 0 5 5 0 0
    0 6 6 0 0 8 8 8 8 8 8 0 9 9 9 9 9 9 9 9 0 0 0 0 0 0 0 7 0 0 0 0 0
    0 6 6 0 0 8 0 0 0 0 0 0 9 9 9 9 9 9 9 9 0 0 7 7 7 7 7 7 7 7 7 7 7
    0 0 0 0 0 8 0 0 0 0 0 0 9 9 0 0 0 0 9 9 0 0 0 0 0 0 7 7 7 0 0 0 0
} $meta]

# # ## ### ##### ######## ############# #####################
unset meta
cleanupTests
return
