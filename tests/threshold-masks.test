# -*- tcl -*- tcl.tk//DSL tcltest//EN//2.0 tcl.tk//DSL tcltest//EN//2.0
## (c) 2023 Andreas Kupries
# # ## ### ##### ######## ############# #####################
## AKTIVE. Thresholding

kt check Tcl     8.6
kt check tcltest 2

# # ## ### ##### ######## ############# #####################

kt local testing aktive

kt source support/util.tcl

# # ## ### ##### ######## ############# #####################
## Syntax

syntax {
    bernsen    {src args}
    niblack    {src args}
    sauvola    {src args}
    phansalkar {src args}
} {aktive image mask per}

syntax {
    bernsen    {src args}
    niblack    {src args}
    sauvola    {src args}
    phansalkar {src args}
} {aktive image threshold}

# # ## ### ##### ######## ############# #####################
##

set in [aktive read from netpbm path [A crop.pgm]]

foreach mp {
    bernsen
    {niblack    k -0.2}
    {sauvola    k  0.5  R 128}
    {phansalkar k  0.25 R 0.5 p 3 q 10}
} {
    set m [lindex $mp 0]
    set p [lrange $mp 1 end]

    test aktive-image-threshold-${m}-2.0 "aktive image threshold $mp" -body {
	aspgm aktive image threshold $m $in {*}$p radius 5
    } -match content/string -result [R ${m}-threshold.pgm]

    test aktive-image-mask-per-${m}-2.0 "aktive image mask per $mp" -body {
	aspgm aktive image mask per $m $in {*}$p radius 5
    } -match content/string -result [R ${m}-mask.pgm]
}

# # ## ### ##### ######## ############# #####################
unset in mp m
cleanupTests
return
