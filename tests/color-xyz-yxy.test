# -*- tcl -*- tcl.tk//DSL tcltest//EN//2.0 tcl.tk//DSL tcltest//EN//2.0
## (c) 2023 Andreas Kupries
# # ## ### ##### ######## ############# #####################
## AKTIVE. Color conversion -- XYZ / CIE Yxy round trip
##         Both directions.

kt check Tcl     8.6
kt check tcltest 2

# # ## ### ##### ######## ############# #####################

kt local testing aktive

kt source support/util.tcl

# # ## ### ##### ######## ############# #####################
## Syntax

syntax {
    XYZ src
} {aktive op color Yxy to}

syntax {
    Yxy src
} {aktive op color XYZ to}

# # ## ### ##### ######## ############# #####################
## Round trip of the 216 web "standard" colors

foreach-color 3 [webcolor-table-fp] rgb bands {

    set xyz    [aktive op color scRGB to XYZ $rgb]
    set xbands [pixels/ $xyz]
    set xb     ([join $xbands ,])

    # # ## ### ##### ######## ############# #####################

    # for the complementary round trip
    set yxy    [aktive op color XYZ to Yxy $xyz]
    set ybands [pixels/ $yxy]
    set yb     ([join $ybands ,])

    incr k

    # # ## ### ##### ######## ############# #####################

    test aktive-op-color-XYZ-to-Yxy-2.${k}-$xb "aktive op color XYZ to Yxy, round trip ($xbands)" -body {
	pixels aktive op color Yxy to XYZ \
	    [aktive op pass \
		 [aktive op color XYZ to Yxy $xyz]]
    } -match pixels -result $xbands

    test aktive-op-color-Yxy-to-XYZ-2.${k}-$yb "aktive op color Yxy to XYZ, round trip ($ybands)" -body {
	pixels aktive op color XYZ to Yxy \
	    [aktive op pass \
		 [aktive op color Yxy to XYZ $yxy]]
    } -match pixels -result $ybands
}

unset rgb bands xyz xbands xb yxy ybands yb k
# # ## ### ##### ######## ############# #####################
cleanupTests
return
