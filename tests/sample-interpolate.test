# -*- tcl -*- tcl.tk//DSL tcltest//EN//2.0 tcl.tk//DSL tcltest//EN//2.0
## (c) 2023,2024 Andreas Kupries
# # ## ### ##### ######## ############# #####################
## AKTIVE. Sample interpolation (low-pass filter after a fill operation) of rows, columns, bands

kt check Tcl     8.6 9
kt check tcltest 2

# # ## ### ##### ######## ############# #####################

kt local testing aktive

kt source support/util.tcl

# # ## ### ##### ######## ############# #####################
## Syntax

syntax {
    x  {src args}
    xy {src args}
    y  {src args}
} {aktive op sample interpolate}

# # ## ### ##### ######## ############# #####################
##
# input/gradient 3x4x2
##
##       0 ....   1......   2...... - 3 columns
##     --------  --------  --------
#	 1  1.5    2  2.5    3  3.5  0
#	 4  4.5    5  5.5    6  6.5  1
#	 7  7.5    8  8.5    9  9.5  2
#	10 10.5   11 11.5   12 12.5  3
##     --- ----  --- ----  --- ----  \ 4 rows
##      0. 1...   0. 1...   0. 1... - 2 bands
#
# Interpolating columns, rows, or bands

foreach {op expected} {
    x {
	=  1.7010   2.3018 =   1.8158   2.3847 =   1.9876   2.5105 =   2.1441   2.6212 =   2.1910   2.6220 =   2.1605   2.5597
	=  5.3062   5.9071 =   5.2295   5.7985 =   5.1251   5.6480 =   5.0067   5.4838 =   4.7772   5.2082 =   4.5553   4.9544
	=  8.9115   9.5124 =   8.6433   9.2123 =   8.2625   8.7854 =   7.8693   8.3464 =   7.3634   7.7945 =   6.9500   7.3492
	= 12.5167  13.1176 =  12.0571  12.6261 =  11.3999  11.9228 =  10.7319  11.2090 =   9.9496  10.3807 =   9.3448   9.7439
    }
    y {
	= 2.6994   3.3003 =   3.9011   4.5020 =   5.1029   5.7038
	= 3.2773   3.8499 =   4.4224   4.9950 =   5.5675   6.1401
	= 4.2615   4.8011 =   5.3407   5.8804 =   6.4200   6.9596
	= 5.3963   5.9058 =   6.4153   6.9248 =   7.4343   7.9439
	= 6.4596   6.9473 =   7.4349   7.9226 =   8.4102   8.8979
	= 7.1631   7.6235 =   8.0838   8.5442 =   9.0046   9.4650
	= 7.3666   7.7912 =   8.2158   8.6404 =   9.0650   9.4896
	= 7.2572   7.6535 =   8.0498   8.4461 =   8.8424   9.2387
    }
    xy {
	= 3.8439   4.5660 =   3.8863   4.5700 =   3.9549   4.5833 =   4.0057   4.5791 =   3.9241   4.4421 =   3.7919   4.2716
	= 4.5102   5.1982 =   4.5055   5.1571 =   4.5059   5.1047 =   4.4898   5.0361 =   4.3470   4.8406 =   4.1761   4.6331
	= 5.6600   6.3085 =   5.5808   6.1949 =   5.4732   6.0375 =   5.3505   5.8654 =   5.1079   5.5731 =   4.8720   5.3027
	= 6.9937   7.6060 =   6.8313   7.4111 =   6.6032   7.1361 =   6.3617   6.8478 =   6.0062   6.4454 =   5.6958   6.1025
	= 8.2498   8.8358 =   8.0117   8.5666 =   7.6741   8.1841 =   7.3243   7.7896 =   6.8647   7.2851 =   6.4850   6.8743
	= 9.0679   9.6212 =   8.7752   9.2991 =   8.3584   8.8399 =   7.9306   8.3699 =   7.3987   7.7956 =   6.9723   7.3397
	= 9.2767   9.7870 =   8.9582   9.4414 =   8.5038   8.9479 =   8.0396   8.4448 =   7.4790   7.8451 =   7.0372   7.3762
	= 9.1170   9.5933 =   8.7954   9.2464 =   8.3361   8.7505 =   7.8679   8.2460 =   7.3095   7.6511 =   6.8728   7.1891
    }
} {
    test aktive-op-sample-interpolate-${op}-2.0 "aktive op sample interpolate $op 2x" -body {
	pixels aktive op sample interpolate $op [grad] by 2
    } -match pixels -result $expected

    set in [grad]
    set id [aktive query id $in]

    test aktive-op-sample-interpolate-${op}-2.2 "aktive op sample interpolate $op, 1x is identity" -body {
	dag aktive op sample interpolate $op $in by 1
    } -match glob -result "image::gradient $id *"

    unset in id
}

# # ## ### ##### ######## ############# #####################
cleanupTests
return
